# 🚀 多币种系统配置指南

## 📋 系统概述

本系统现已支持多币种交易和管理，从原来的单一SOL/USDT扩展到支持多种主流加密货币的DCA交易、技术分析、策略评分等功能。

## 🎯 支持的币种

### 默认支持的币种
| 币种 | 符号 | 交易对 | 风险等级 | 描述 |
|------|------|--------|----------|------|
| Solana | SOL | SOLUSDT | 中等 | 高性能区块链平台 |
| Bitcoin | BTC | BTCUSDT | 低 | 数字黄金，加密货币之王 |
| Ethereum | ETH | ETHUSDT | 中等 | 智能合约平台 |
| Cardano | ADA | ADAUSDT | 中等 | 学术驱动的区块链平台 |
| Polkadot | DOT | DOTUSDT | 中等 | 多链互操作平台 |
| Chainlink | LINK | LINKUSDT | 高 | 去中心化预言机网络 |
| Polygon | MATIC | MATICUSDT | 高 | 以太坊扩展解决方案 |
| Avalanche | AVAX | AVAXUSDT | 高 | 高性能智能合约平台 |
| Uniswap | UNI | UNIUSDT | 高 | 去中心化交易所代币 |
| Cosmos | ATOM | ATOMUSDT | 中等 | 区块链互联网 |

## 🗄️ 数据库结构

### 核心表结构

#### 1. 币种配置表 (`currency_config`)
```sql
- symbol: 币种符号 (SOL, BTC, ETH, etc.)
- name: 币种名称
- full_name: 完整名称
- trading_pair: 交易对 (SOLUSDT, BTCUSDT, etc.)
- is_active: 是否启用
- min_order_amount: 最小订单金额
- max_order_amount: 最大订单金额
- risk_level: 风险等级 (LOW, MEDIUM, HIGH)
- description: 币种描述
```

#### 2. 币种价格历史表 (`currency_price_history`)
```sql
- symbol: 币种符号
- price_usdt: USDT价格
- price_btc: BTC价格
- volume_24h: 24小时成交量
- market_cap: 市值
- price_change_24h: 24小时价格变化
- price_change_7d: 7天价格变化
- high_24h: 24小时最高价
- low_24h: 24小时最低价
```

#### 3. 币种技术指标表 (`currency_technical_indicators`)
```sql
- symbol: 币种符号
- ema_89/21/7: 指数移动平均线
- rsi_14: 相对强弱指数
- macd: MACD指标
- obv: 能量潮指标
- bollinger_upper/middle/lower: 布林带
- stoch_k/d: 随机指标
- atr: 平均真实波幅
- volatility: 波动率
- support_level: 支撑位
- resistance_level: 阻力位
```

#### 4. 币种策略评分表 (`currency_strategy_scores`)
```sql
- symbol: 币种符号
- ema_score: EMA评分
- rsi_score: RSI评分
- macd_score: MACD评分
- obv_score: OBV评分
- volatility_score: 波动率评分
- volume_score: 成交量评分
- total_score: 总评分
- recommendation: 推荐操作
- confidence: 置信度
- risk_level: 风险等级
- trend: 趋势方向
- market_sentiment: 市场情绪
```

#### 5. 多币种DCA设置表 (`multi_currency_dca_settings`)
```sql
- symbol: 币种符号
- is_active: 是否激活
- base_amount: 基础订单金额
- max_orders: 最大订单数
- amount_multiplier: 金额递增倍数
- price_deviation: 价格偏离度
- take_profit_percentage: 止盈百分比
- stop_loss_percentage: 止损百分比
- strategy_type: 策略类型
- risk_tolerance: 风险承受度
```

#### 6. 多币种持仓表 (`multi_currency_positions`)
```sql
- symbol: 币种符号
- position_type: 持仓类型 (LONG/SHORT)
- entry_price: 入场价格
- quantity: 数量
- total_amount: 总金额
- stop_loss: 止损价格
- take_profit: 止盈价格
- status: 状态 (ACTIVE/CLOSED)
- pnl: 盈亏
- trailing_stop_enabled: 移动止盈启用
```

#### 7. 币种组合配置表 (`currency_portfolio_config`)
```sql
- portfolio_name: 组合名称
- target_allocation: 目标配置 (JSON格式)
- rebalance_threshold: 再平衡阈值
- max_single_currency: 单一币种最大比例
- risk_level: 风险等级
```

## 🔧 安装配置

### 1. 数据库初始化

执行多币种数据库脚本：
```bash
# 在Supabase控制台SQL编辑器中执行
# 运行 multi-currency-database.sql 文件中的所有SQL语句
```

### 2. 环境变量配置

在 `.env.local` 文件中添加：
```env
# 币安API配置（必需）
BINANCE_API_KEY=your_binance_api_key
BINANCE_API_SECRET=your_binance_api_secret

# Supabase配置（必需）
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
SUPABASE_SERVICE_ROLE_KEY=your_supabase_service_key

# 可选：CoinGecko API密钥
COINGECKO_API_KEY=your_coingecko_api_key
```

### 3. 启动系统

```bash
npm install
npm run dev
```

## 📊 API接口

### 多币种核心API (`/api/multi-currency`)

#### GET 请求
- `?action=list` - 获取所有活跃币种列表
- `?action=prices&limit=50` - 获取币种价格数据
- `?action=indicators&symbol=SOL` - 获取技术指标数据
- `?action=scores&limit=50` - 获取策略评分数据
- `?action=recommendations&limit=10` - 获取币种推荐列表
- `?action=portfolio&user_id=default_user` - 获取用户组合数据

#### POST 请求
```json
{
  "action": "add_currency",
  "data": {
    "symbol": "NEW",
    "name": "NewCoin",
    "trading_pair": "NEWUSDT",
    "risk_level": "MEDIUM"
  }
}
```

#### DELETE 请求
- `?symbol=SOL&action=disable` - 禁用币种
- `?symbol=SOL&action=delete` - 删除币种

## 🎨 前端组件

### 1. 多币种显示组件 (`MultiCurrencyDisplay`)
- 实时价格显示
- 技术指标展示
- 策略评分
- 收藏功能
- 排序和筛选

### 2. 使用方式
```tsx
import MultiCurrencyDisplay from '@/components/MultiCurrencyDisplay'

export default function Page() {
  return (
    <div className="container mx-auto p-4">
      <MultiCurrencyDisplay />
    </div>
  )
}
```

## 🔄 数据更新机制

### 1. 价格数据更新
- 来源：币安API
- 频率：实时（用户请求时）
- 备用：CoinGecko API

### 2. 技术指标计算
- EMA: 指数移动平均线
- RSI: 相对强弱指数
- MACD: 移动平均收敛散度
- OBV: 能量潮指标
- 布林带、随机指标等

### 3. 策略评分算法
```typescript
// 评分权重
const weights = {
  ema: 0.25,
  rsi: 0.20,
  macd: 0.20,
  obv: 0.15,
  volatility: 0.10,
  volume: 0.10
}

// 总评分计算
totalScore = emaScore * weights.ema + 
             rsiScore * weights.rsi + 
             macdScore * weights.macd + 
             obvScore * weights.obv + 
             volatilityScore * weights.volatility + 
             volumeScore * weights.volume
```

## 🎯 DCA策略配置

### 1. 基础配置
```json
{
  "symbol": "SOL",
  "base_amount": 80,
  "max_orders": 6,
  "amount_multiplier": 1.5,
  "strategy_type": "BALANCED",
  "risk_tolerance": "MEDIUM"
}
```

### 2. 策略类型
- **CONSERVATIVE**: 保守型（低风险，小金额）
- **BALANCED**: 平衡型（中等风险，中等金额）
- **AGGRESSIVE**: 激进型（高风险，大金额）

### 3. 风险承受度
- **LOW**: 低风险承受度
- **MEDIUM**: 中等风险承受度
- **HIGH**: 高风险承受度

## 📈 组合管理

### 1. 创建组合
```json
{
  "portfolio_name": "我的组合",
  "target_allocation": {
    "BTC": 0.4,
    "ETH": 0.3,
    "SOL": 0.2,
    "ADA": 0.1
  },
  "rebalance_threshold": 5.0,
  "max_single_currency": 50.0,
  "risk_level": "MEDIUM"
}
```

### 2. 再平衡机制
- 当单一币种偏离目标配置超过阈值时触发
- 自动调整持仓比例
- 支持手动再平衡

## 🔒 安全配置

### 1. API密钥安全
- 使用环境变量存储
- 设置IP白名单
- 定期轮换密钥
- 最小权限原则

### 2. 交易安全
- 余额检查
- 订单限制
- 风险控制
- 异常监控

## 📊 监控和日志

### 1. 系统监控
- API调用频率
- 数据库性能
- 错误率统计
- 用户行为分析

### 2. 日志记录
- 交易记录
- 错误日志
- 性能日志
- 安全日志

## 🚀 扩展功能

### 1. 新增币种
1. 在 `currency_config` 表中添加配置
2. 确保币安API支持该交易对
3. 更新前端组件显示
4. 测试价格获取和技术指标计算

### 2. 自定义指标
1. 在 `currency_technical_indicators` 表中添加字段
2. 实现指标计算逻辑
3. 更新策略评分算法
4. 修改前端显示

### 3. 高级功能
- 网格交易
- 套利策略
- 期权交易
- 期货交易
- 社交交易

## 📞 技术支持

### 常见问题
1. **价格数据不更新**: 检查币安API配置
2. **技术指标计算错误**: 验证历史数据完整性
3. **DCA交易失败**: 确认账户余额和API权限
4. **数据库连接错误**: 检查Supabase配置

### 联系方式
- 技术支持: [您的联系方式]
- 文档更新: [文档地址]
- 问题反馈: [反馈渠道]

---

**注意**: 本系统涉及真实交易，请务必在充分了解风险的情况下使用，建议先使用小额资金测试。 